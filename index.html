<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>pulsartronic.com - IPFS Map</title>

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<link rel="apple-touch-icon" href="/img/memory-chip.png">
		<meta name="mobile-web-app-capable" content="yes">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="shortcut icon" sizes="196x196" href="http://pulsartronic.com/img/memory-chip.png">
		<meta name="Description" content="GPS tracker">
		<link rel="canonical" href="https://pulsartronic.com" />
		
		<meta property="og:image" content="http://pulsartronic.com/img/memory-chip.png"/>
		<meta property="og:title" content="IPFS tile server"/>
		<meta property="og:type" content="game"/>
		<meta property="og:url" content="https://pulsartronic.com"/>
		<meta property="og:site_name" content=""/>
		<meta property="og:description" content="IPFS tile server example"/>

		<script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>
	</head>

	<body style="position:absolute;top:0;bottom:0;left:0;right:0;margin:0;padding:0;">
		<div id="ipfsmap" style="position:absolute;top:0;bottom:0;left:0;right:0;"></div>
	</body>
</html>

<script>
let TILE_SERVER = /*'http://pulsartronic.duckdns.org/' + */"tile.php?z={z}&x={x}&y={y}";

let ipfsmap = {};
ipfsmap.init = async function() {
	let tsource = new ol.source.OSM({url:TILE_SERVER});
	let tlayer = new ol.layer.Tile({"source":tsource});
	let layers = [tlayer];
	let saved = localStorage.getItem("coords") || "[2.191783379982894, 41.4349839095253]";
	let savedCoords = JSON.parse(saved);
	let zoom = +localStorage.getItem("zoom") || 12;
	let view = new ol.View({"center":ol.proj.fromLonLat(savedCoords), "zoom":zoom});
	this.map = new ol.Map({"target": 'ipfsmap', "layers":layers, "view":view});
	this.map.on('moveend', (e) => {
		let coords = ol.proj.transform(this.map.getView().getCenter(), 'EPSG:3857', 'EPSG:4326');
		localStorage.setItem("coords", JSON.stringify(coords));
		let zoom = this.map.getView().getZoom();
		localStorage.setItem("zoom", zoom);
	});
};

window.onload = function() {
	ipfsmap.init();
};

</script>
